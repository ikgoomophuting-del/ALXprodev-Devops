#!/bin/bash

# Directory containing the PokÃ©mon JSON files
INPUT_DIR="pokemon_data"
OUTPUT_FILE="pokemon_report.csv"

# Ensure the input directory exists
if [ ! -d "$INPUT_DIR" ]; then
  echo "Error: Directory '$INPUT_DIR' not found!"
  exit 1
fi

# Create or overwrite the CSV report
echo "Name,Height (m),Weight (kg)" > "$OUTPUT_FILE"

# Loop through all JSON files in the directory
for file in "$INPUT_DIR"/*.json; do
  # Extract values using jq
  NAME=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  HEIGHT=$(jq -r '.height' "$file" | awk '{printf "%.1f", $1/10}')  # decimeters to meters
  WEIGHT=$(jq -r '.weight' "$file" | awk '{printf "%.1f", $1/10}')  # hectograms to kilograms

  # Append to CSV
  echo "$NAME,$HEIGHT,$WEIGHT" >> "$OUTPUT_FILE"
done

# Display report path
echo "CSV Report generated at: $OUTPUT_FILE"
echo

# Print CSV contents
cat "$OUTPUT_FILE"
echo

# Calculate averages using awk
awk -F, '
NR>1 {h+=$2; w+=$3; c++}
END {
  printf "\nAverage Height: %.2f m\nAverage Weight: %.2f kg\n", h/c, w/c
}' "$OUTPUT_FILE"
